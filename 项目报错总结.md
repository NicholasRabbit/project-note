#### 1，非操作数据代码导致事务超时

有条设置时间为00:00 - 23:59，当加到最后一个时间段的时候，例如22:50 + 15:00就成了00:05 ，又小于23:59了，开始死循环。

心得总结：
（1）因为报的错一直是：Lock wait timeout exceeded，导致一直排查个人写的操作数据库语句，实际下面的死循环的非操作数据库的代码写在了整个事务中，导致事务无法提交，最终超时。
（2）注意静态检查，数据越界问题，如本例中，加完应该时下一天的时间，由于截掉了年月日，却比23:59还小了，导致死循环。同理使用int等数据类型时也应考虑这种越界的情况。

**排查错误的时候，有时候报错只是表面现象，要一步步debug往下排查，尤其在事务中的循环语句要重点关注。**

```java
//无人值守项目：错误代码
//组装集合
    private List<YyDaily> getDailyList( YySetting yySetting){
        List<YyDaily> dailyList = new ArrayList<>();
        //停运，则不生成预约表
        if(2 == yySetting.getType()){
            return dailyList;
        }
        //开始时间
        LocalTime start = LocalTime.parse(yySetting.getStartTime(), DateTimeFormatter.ofPattern("HH:mm"));
        //预存每天开始时间
        LocalTime tempStart = start;
        LocalTime end = LocalTime.parse(yySetting.getEndTime(),DateTimeFormatter.ofPattern("HH:mm"));
        LocalDate startDate = yySetting.getStartDate();
        LocalDate endDate = yySetting.getEndDate();
        while(startDate.compareTo(endDate) <= 0){
            System.out.println("========1111=======");
            
            for(;start.compareTo(end) < 0;){
                //这里一直死循环
                System.out.println("========2222=======");
                YyDaily yyDaily = new YyDaily();      
      BeanUtil.copyProperties(yySetting,yyDaily,"id","createBy","createTime","updateBy","updateTime","delFlag");
                //时间段开始时间单独设置
                yyDaily.setStartTime(start.toString());
                //单独设置预约表每行的日期
                yyDaily.setSendDate(startDate);
                //关联预约设置表id
                yyDaily.setSettingId(yySetting.getId());
                IntervalTimeStrategy timeStrategy = null;
                if(0 == yySetting.getSeparate()){  //按小时分割
                    timeStrategy = new PlusHour();
                    start = timeStrategy.plus(start,1L);
                }else if(1 == yySetting.getSeparate()){  //按分钟，30分钟
                    timeStrategy = new PlusMinute();
                    start = timeStrategy.plus(start,30L);
                }else if(2 == yySetting.getSeparate()){  //按分钟，一刻钟
                    timeStrategy = new PlusMinute();
                    start = timeStrategy.plus(start,15L);
                }
                //设置该时间段结束时间
                if(start.toString().compareTo(yySetting.getEndTime()) > 0){
                    yyDaily.setEndTime(yySetting.getEndTime());
                }else{
                    yyDaily.setEndTime(start.toString());
                }
                dailyList.add(yyDaily);
            }
            //每天开始时间初始化
            start = tempStart;
            startDate = startDate.plusDays(1);
        }
        return dailyList;
    }
```

